services:
  nethermind:
    image: nethermind/nethermind:latest
    container_name: optimism-execution
    restart: unless-stopped

    command:
      # --- Basic configuration ---
      - --config=op-mainnet
      - --datadir=/nethermind/data
      - --JsonRpc.Enabled=true
      - --JsonRpc.Host=0.0.0.0
      - --JsonRpc.Port=8545
      - --JsonRpc.WebSocketsPort=8546
      - --JsonRpc.EnabledModules=eth,web3,net,debug,trace,txpool,subscribe
      - --JsonRpc.JwtSecretFile=/nethermind/jwt/jwt.hex
      - --JsonRpc.EngineHost=0.0.0.0
      - --JsonRpc.EnginePort=8551

      # --- Sync settings ---
      - --Sync.SnapSync=true
      # Uncomment for archive node:
      # - --Pruning.Mode=None

      # --- P2P / Discovery ---
      - --Network.DiscoveryPort=30303
      - --Network.P2PPort=30303

    ports:
      # JSON-RPC HTTP (exposed as 8543)
      - "8543:8545"

      # JSON-RPC WebSocket (exposed as 8544)
      - "8544:8546"

      # P2P (TCP + UDP)
      - "30306:30303/tcp"
      - "30306:30303/udp"

    volumes:
      - $HOME/optimism/data:/nethermind/data
      - $HOME/optimism/jwt:/nethermind/jwt:ro

    logging:
      driver: "local"

  op-node:
    image: us-docker.pkg.dev/oplabs-tools-artifacts/images/op-node:latest
    container_name: optimism-consensus
    restart: unless-stopped
    depends_on:
      - nethermind

    command:
      - op-node
      - --l1=http://<L1_RPC_URL>:8546
      - --l1.rpckind=standard
      - --l1.beacon=https://<L1_BEACON_URL>
      - --l2=http://nethermind:8551
      - --l2.jwt-secret=/jwt/jwt.hex
      - --syncmode=execution-layer
      - --network=op-mainnet
      - --rpc.addr=0.0.0.0
      - --rpc.port=9545

    ports:
      # op-node RPC (exposed as 8555)
      - "8555:9545"

    volumes:
      - $HOME/optimism/jwt:/jwt:ro

    logging:
      driver: "local"
